
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Sym Okta Quickstart Tutorial</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="UA-156651818-3"
                  id="sym_okta_quickstart"
                  title="Sym Okta Quickstart Tutorial"
                  environment="web"
                  feedback-link="mailto:sales@symops.io">
    
      <google-codelab-step label="Welcome" duration="2">
        <p>Hey! I&#39;m <a href="https://twitter.com/yasyf" target="_blank">Yasyf</a>, CEO at <a href="https://www.symops.com/" target="_blank">Sym</a>.</p>
<p>Sym helps engineering teams automate security workflows with a sophisticated access management platform that lets you bring audited &amp; automatic just-in-time access to AWS resources, SQL databases, internal apps &amp; dashboards, and a variety external SaaS products. Workflows are provisioned via infra-as-code, often right beside the definitions of the resources they protect, and are easily customizable with our Python SDK.</p>
<p>If you want to check out a demo, go <a href="https://demo.symops.com/" target="_blank">here</a>!</p>
<h2 is-upgraded>Workflow</h2>
<p>Today I want to walk you through setting up a simple access control workflow using Slack, Okta and Sym. By the end of this tutorial, you&#39;ll have the ability to wrap any resource in Okta with a fully-configurable request-and-approval flow, using a declaratively provisioned Slack bot.</p>
<p>The complete code for this tutorial can be found at <a href="https://github.com/symopsio/sym-okta-quickstart" target="_blank"><code>@symopsio/sym-okta-quickstart</code></a>.</p>
<h2 is-upgraded>What will it look like?</h2>
<p>Users will interact with this Sym <code>Flow</code> via Slack. Slack connects to the Sym platform, which executes a <code>Flow</code> that use the <code>Integrations</code> we are wiring together in this tutorial.</p>
<p class="image-container"><img alt="End-User Workflow" src="img/fbdcfce77de0593b.jpg"></p>
<h3 is-upgraded>Making Requests</h3>
<p>This is what a request will look like.</p>
<p class="image-container"><img alt="Request Modal" src="img/1ae1e5456f57ded5.png"></p>
<p>Sym will send a request for approval to the appropriate users or channel based on your <a href="https://github.com/symopsio/sym-okta-quickstart/blob/main/modules/okta-access-flow/impl.py" target="_blank"><code>impl.py</code></a>.</p>
<p class="image-container"><img alt="Approval Request" src="img/d5bbcfb6e5d94ec1.png"></p>
<p>Finally, upon approval, Sym gives you access to the Okta group and updates Slack.</p>
<p class="image-container"><img alt="Approved Access" src="img/22e8dbe5209764de.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Environment Setup" duration="3">
        <p>To complete this tutorial, you should <a href="https://learn.hashicorp.com/terraform/getting-started/install" target="_blank">install Terraform</a>, and make sure you have a working install of Python 3.</p>
<h2 is-upgraded>What&#39;s Next</h2>
<p>The <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app" target="_blank">app environment</a> includes everything you need to get an Okta workflow up and running. Just configure a few variables in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>terraform.tfvars</code></a> and you&#39;re on your way!</p>
<p>Here&#39;s all that you&#39;ll need to do:</p>
<ul>
<li>[ ] Set up the <code>symflow</code> CLI</li>
<li>[ ] Install the Sym Slack app</li>
<li>[ ] Configure your Slack channels</li>
<li>[ ] Test your deploy flow</li>
<li>[ ] Set up your Okta API token</li>
<li>[ ] Set up your Okta <code>Targets</code></li>
<li>[ ] E2E test and more goodies!</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Set up the 
symflow CLI" duration="3">
        <p>You&#39;ll need to work with the Sym team to get your organization set up with access to the Sym platform. Once you&#39;re onboarded, continue from here.</p>
<h2 is-upgraded>Install the <code>symflow</code> CLI</h2>
<p>The <a href="https://docs.symops.com/docs/install-sym-flow-cli" target="_blank"><code>symflow</code></a> CLI is what you use to interact with Sym&#39;s control plane.</p>
<pre><code language="language-bash" class="language-bash">$ brew install symopsio/tap/symflow
</code></pre>
<pre><code>==&gt; Tapping symopsio/tap
Cloning into &#39;/opt/homebrew/Library/Taps/symopsio/homebrew-tap&#39;...
remote: Enumerating objects: 1148, done.
remote: Counting objects: 100% (285/285), done.
remote: Compressing objects: 100% (222/222), done.
remote: Total 1148 (delta 134), reused 156 (delta 59), pack-reused 863
Receiving objects: 100% (1148/1148), 324.27 KiB | 6.36 MiB/s, done.
Resolving deltas: 100% (530/530), done.
Tapped 14 formulae (43 files, 582.7KB).
==&gt; Downloading https://github.com/symopsio/sym-flow-cli-releases/releases/download/v1.3.7/sym-flow-cli-darwin-x64.tar.gz
######################################################################## 100.0%
==&gt; Installing symflow from symopsio/tap
üç∫  /opt/homebrew/Cellar/symflow/1.3.7: 10,351 files, 198MB, built in 33 second
</code></pre>
<h2 is-upgraded>Login</h2>
<p>We&#39;ll have to login before we can do anything else. Sym also supports SSO, if your organization has set it up.</p>
<pre><code language="language-bash" class="language-bash">$ symflow login
</code></pre>
<pre><code>Sym Org: healthy-health
Username: yasyf@healthy-health.co
Password: ************
MFA Token: ******

Success! Welcome, Yasyf. ü§ì
</code></pre>
<h2 is-upgraded>Set your Org slug</h2>
<p>You simply have to take the <code>slug</code> given to you by the Sym team, and set it in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>app/terraform.tfvars</code></a>.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

sym_org_slug = &#34;healthy-health&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Install the Sym Slack app" duration="3">
        <p>Now that you&#39;ve got <code>symflow</code> installed, you need to install Sym&#39;s Slack app into your workspace.</p>
<h2 is-upgraded>Grab your Workspace ID</h2>
<p>The easiest place to find this is in the URL you see when you run Slack in your web browser. It will start with a <code>T</code>, and look something like <code>TABC123</code>.</p>
<p>This also goes in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>app/terraform.tfvars</code></a>.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

slack_workspace_id = &#34;TABC123&#34;
</code></pre>
<h2 is-upgraded>Provision your Slack app</h2>
<p><code>symflow</code> has a convenient way to provision an instance of Sym&#39;s Slack app. This command will generate an install link that you can either use directly, or forward on to your Workspace Administrator.</p>
<pre><code language="language-bash" class="language-bash">$ symflow services create --service-type slack --external-id T123ABC
</code></pre>
<pre><code>Successfully set up service type slack with external ID TABC123!
Generated an installation link for the Sym Slack app:

https://static.symops.com/slack/install?token=xxx

Please send this URL to an administrator who has permission to install the app. Or, if that&#39;s you, we can open it now.

Would you like to open the Slack installation URL in a browser window? [Y/n]:
</code></pre>
<p>Once Slack is set up, try launching the Sym app with <code>/sym</code> in Slack.</p>
<p>You should see a welcome modal like this one, since we haven&#39;t set up a <code>Flow</code> yet:</p>
<p class="image-container"><img alt="Slack Welcome Modal" src="img/e0d599e8ac26c660.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Configure your Slack channels" duration="1">
        <p>This <code>Flow</code> is set up to route access requests to the <code>#sym-requests</code> channel. You can change this channel in‚Äîwait for it‚Äî<a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>terraform.tfvars</code></a>.</p>
<p>Sym will also send any errors that happen during a <code>Run</code> (due to external failures or config issues) to a configurable error channel. You&#39;ll never guess where you can configure this.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

flow_vars = {
  request_channel = &#34;#sym-requests&#34;
}
</code></pre>
<p>You can also change the channel that errors are routed to, which defaults to <code>#sym-errors</code>.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

error_channel = &#34;#sym-errors&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Test your deploy flow" duration="1">
        <p>Now that Slack is set up, let&#39;s provision your flow! The Okta <code>Integration</code> isn&#39;t ready quite yet, but we can at least make sure all the pipes are connected.</p>
<pre><code language="language-bash" class="language-bash">$ export AWS_PROFILE=my-profile
$ cd app
$ terraform apply
</code></pre>
<pre><code>...
Plan: 18 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only &#39;yes&#39; will be accepted to approve.

  Enter a value: yes

Apply complete! Resources: 18 added, 0 changed, 0 destroyed.
</code></pre>
<aside class="special"><p>By the way, if you plan to provision your flows from a CI pipeline, <a href="https://docs.symops.com/docs/using-bot-tokens" target="_blank">we&#39;ve got you covered</a>.</p>
</aside>
<h2 is-upgraded>Try out a request!</h2>
<p>You should be able to make a request now with <code>/sym req</code>, though you&#39;ll get an error when you try to approve access, since we haven&#39;t configured Okta yet.</p>
<p>Check in your <code>errors_channel</code> and you should see something like this:</p>
<p class="image-container"><img alt="OktaError" src="img/83b0c24409c556d6.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Set up your Okta API token" duration="3">
        <p>Sym stores your Okta API token in an AWS Secrets Manager value. By default, the <code>sym-runtime</code> module sets up a shared AWS Secrets Manager secret that you add key/value pairs to for the secrets that your <code>Runtime</code> needs to access.</p>
<h2 is-upgraded>Create your API token</h2>
<p>Follow our <a href="https://docs.symops.com/docs/okta" target="_blank">Okta setup instructions</a> to create an Okta API token that has access to manage your target groups.</p>
<h2 is-upgraded>Set your API token in Sym</h2>
<p>Configure the API key in the AWS Secrets Manager secret configured by your <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/modules/sym-runtime/main.tf" target="_blank"><code>sym-runtime</code></a> module like so.</p>
<pre><code language="language-bash" class="language-bash">$ OKTA_API_TOKEN=xxx
$ aws secretsmanager put-secret-value \
  --secret-id /symops.com/shared \
  --secret-string &#34;{\&#34;okta_api_token\&#34;: \&#34;$OKTA_API_TOKEN\&#34;}&#34;
</code></pre>
<aside class="special"><p>n.b. You are free to define your secrets in separate AWS Secret Manager resources if you choose, you&#39;ll just need to update where your <code>Flow</code> grabs its secret from.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Set up your Okta 
Targets" duration="3">
        <p>Identify the initial Okta groups that Sym will move users in and out of. You can always change and modify these groups later, so we recommend starting with an existing group or creating a temporary group for testing.</p>
<h2 is-upgraded>Set Group IDs</h2>
<p>Get the IDs of the Okta groups that you&#39;ll be starting with. Configure these in <code>okta_targets</code> in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>terraform.tfvars</code></a>.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

okta_targets = [
  {
    label    = &#34;AWS Ops Admin&#34;,
    group_id = &#34;CHANGEME&#34;
  }
]
</code></pre>
<h2 is-upgraded>Set Okta domain</h2>
<p>Set your <a href="https://developer.okta.com/docs/guides/find-your-domain/main/" target="_blank">Okta domain</a> as well.</p>
<pre><code language="language-hcl" class="language-hcl"># app/terraform.tfvars

okta_org_domain = &#34;xxx.okta.com&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="E2E test and more goodies!" duration="3">
        <p>Now that you&#39;ve configured your Okta <code>Targets</code>, its time to reapply your Terraform configs and validate that your integration works end-to-end.</p>
<p>Run a <code>terraform apply</code> and then request access to your Okta target. Once complete, your request should be approved with no errors!</p>
<pre><code language="language-bash" class="language-bash">$ terraform apply
</code></pre>
<pre><code>...
Plan: 0 to add, 3 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only &#39;yes&#39; will be accepted to approve.

  Enter a value: yes

Apply complete! Resources: 0 added, 3 changed, 0 destroyed.
</code></pre>
<h2 is-upgraded>What&#39;s next?</h2>
<p>Here are some next steps to consider:</p>
<ul>
<li>Set up <a href="https://docs.symops.com/docs/reporting-overview" target="_blank">reporting</a>. Ship audit data to a flexible group of <code>LogDestinations</code>.</li>
<li>Update your <code>Flow</code> to require that users be members of a certain Okta group to approve access:  <ol type="1">
<li>Configure <code>flow_vars.approver_group</code> with the Okta group ID in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/app/terraform.tfvars" target="_blank"><code>terraform.tfvars</code></a>.</li>
<li>Uncomment the <code>hook</code> annotation on the <code>on_approve</code> method in <a href="https://github.com/symopsio/sym-okta-quickstart/tree/main/modules/okta-access-flow/impl.py" target="_blank"><code>impl.py</code></a>. This is just one example of what you can do with <a href="https://docs.symops.com/docs/handlers" target="_blank">hooks in the SDK!</a></li>
</ol>
</li>
<li>Manage <a href="https://docs.symops.com/docs/manage-users" target="_blank">users</a>. Sym handles the &#34;happy path&#34; where user emails match across systems automatically. You can use the <code>symflow</code> CLI to configure user mappings when required.</li>
<li>Iterate on your <code>Flow</code> logic. Maybe change things to allow self-approval only for on-call users?</li>
<li>Set up another access <code>Flow</code>!</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
